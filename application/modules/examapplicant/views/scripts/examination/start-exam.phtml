<style>
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.4.5/fabric.js"></script>
<script type="text/javascript">


$(function() {
	 
	$(".next").click(function(){
	var order=$("#order").val();
	if (order<=$("#n_of_quest").val()) {
		 	$.ajax({
					url: '<?php echo $this->baseUrl();?>/examapplicant/examination/ajax-get-question',
					type: 'POST',
					data: {'apa_id': $("#apa_id").val(),'order':order+1},
					dataType: 'json',
					error: function(){
							alert("Terjadi masalah saat menghapus data !");
						}, 
					}).done(function ( data ) {
		 					//$("#QuestionTxt").val(data.question);
		 					$("#ordertxt").text(data.apad_ques_no);
		 					$("#order").val(data.apad_ques_no);
		 					$("#answer").val(data.apad_appl_ans);
		 					$("#answered"+order+1).text(data.apad_appl_ans);
		 					$("#idQuestion").val(data.idQuestion);
		 					$("#apad_id").val(data.apad_id);
		 					var urllink=data.question_url;
		 					
		 					populateCanvas("Question",urllink);
		 					if (data.question_parent_url!='') 
			 					populateCanvas("parent",data.question_parent_url);
		 					else $("#parent").empty();
		 			});
			}
	});

	$(".pre").click(function(){
		var order=$("#order").val();
		if (order>1) {
			 	$.ajax({
						url: '<?php echo $this->baseUrl();?>/examapplicant/examination/ajax-get-question',
						type: 'POST',
						data: {'apa_id': $("#apa_id").val(),'order':order-1},
						dataType: 'json',
						error: function(){
								alert("Terjadi masalah saat menghapus data !");
							}, 
						}).done(function ( data ) {
			 					//$("#QuestionTxt").val(data.question);
			 					$("#ordertxt").text(data.apad_ques_no);
			 					$("#order").val(data.apad_ques_no);
			 					$("#apad_id").val(data.apad_id);
			 					$("#answer").val(data.apad_appl_ans);
			 					$("#answered"+order+1).text(data.apad_appl_ans);
			 					$("#idQuestion").val(data.idQuestion);
			 					var urllink=data.question_url;
			 					populateCanvas("Question",urllink);
			 					if (data.question_parent_url!='') 
				 					populateCanvas("parent",data.question_parent_url);
			 					else $("#parent").empty();
			 			});
				}
			});
		 
		
 
});
function getQuestion(order){
	$.ajax({
		url: '<?php echo $this->baseUrl();?>/examapplicant/examination/ajax-get-question',
		type: 'POST',
		data: {'apa_id': $("#apa_id").val(),'order':order},
		dataType: 'json',
		error: function(){
				alert("Terjadi masalah saat menghapus data !");
			}, 
		}).done(function ( data ) {
					//$("#QuestionTxt").val(data.question);
					$("#ordertxt").text(data.apad_ques_no);
					$("#order").val(data.apad_ques_no);
					$("#apad_id").val(data.apad_id);
					$("#answer").val(data.apad_appl_ans);
					$("#answered"+order+1).text(data.apad_appl_ans);
					$("#idQuestion").val(data.idQuestion);
					 
					var urllink=data.question_url;
					
					populateCanvas("Question",urllink);
					if (data.question_parent_url!='') 
 					populateCanvas("parent",data.question_parent_url);
					else $("#parent").empty();
			});
}

function populateCanvas(canvasid,imageurl) {
	var urllink=imageurl; 
	const canvas = new fabric.Canvas(canvasid)
	const imgEl = document.createElement("img");
	imgEl.src = urllink;
	imgEl.onload = () => {
	  const img = new fabric.Image(imgEl)
	  img.set({
	    left: 50,
	    top: 50,
	    scaleX: 1,
	    scaleY: 1
	  });
	  canvas.add(img);
	  canvas.requestRenderAll(); 
	  canvas.setWidth(img.getScaledWidth());
	  canvas.setHeight(img.getScaledHeight());
	  img.set({
	      left: 0,
	      top: 0
	   });
	  img.setCoords();
	  canvas.requestRenderAll();
	}
}

function saveAnswer(answer){
	 
	var idQuestion=$("#idQuestion").val();
	var order=$("#order").val();
	 
	$.ajax({
		  type: "POST",
		  url: "/examapplicant/examination/ajax-save-answer",
		  data: {'idQuestion':idQuestion,'apa_id':$("#apa_id").val(),'answer':answer,'order':order},
		  dataType: 'json'
		})
		.done(function(respond){
			 $("#answered"+order).text(respond.answer);
			 
			})
		.fail(function(respond){console.log("fail");})
		.always(function(respond){console.log("always");
	});
}

function firstQuestion(Qurl,parenturl) {
 	populateCanvas("Question",Qurl);
	if (parenturl!='') 
		populateCanvas("parent",parenturl);
	else $("#parent").empty();
}

$(window).bind("load", function() {
	   // code here
	firstQuestion($('#question_url').val(),$('#question_parent_url').val());
});
 
</script> 
<body >
<?php if(isset($this->noticeMessage)){?>
<div class="message notice"><strong><?php echo $this->noticeMessage;?></strong>.</div>
<?php }?>
<?php if(isset($this->noticeSuccess)){?>
<div class="message success"><strong><?php echo $this->noticeSuccess;?></strong>.</div>
<?php }?>
<?php if(isset($this->noticeError)){?>
<div class="message error"><strong><?php echo $this->noticeError;?></strong>.</div>
<?php }?>
<input type="hidden" id="apa_id" name="apa_id" value="<?php echo $this->question['apad_apa_id']?>">
<input type="hidden" id="apad_id" name="apad_id" value="<?php echo $this->question['apad_id']?>">
<input type="hidden" id="idQuestion" value="<?php echo $this->question['idQuestion']?>">
<input type="hidden" id="order" value="1">
<input type="hidden" id="question_url" value="<?php echo $this->question['question_url']?>">
<input type="hidden" id="question_parent_url" value="<?php echo $this->question['question_parent_url']?>">
<input type="hidden" id="n_of_quest" value="<?php echo $this->n_of_quest?>">
<div>
	<fieldset>
		<legend><?php echo $this->translate("Answer Result");?></legend>
			<table class="table">
			<?php $nrow=2;
				for ($j=1;$j<=$nrow;$j++) {?>
			<tr><?php for ($i=($j-1)*$this->n_of_quest/$nrow+1;$i<=$j*$this->n_of_quest/$nrow;$i++) {?><td  width="2%" bgcolor="darkgrey" align="center"><font color="white"><a href="#" onclick="getQuestion('<?php echo $i?>')"><?php echo $i;?></a></font></td><?php }?></tr> 
			<tr><?php for ($i=($j-1)*$this->n_of_quest/$nrow+1;$i<=$j*$this->n_of_quest/$nrow;$i++) {?><td  width="2%" bgcolor="white"><div id="answered<?php echo $i;?>"></div></td><?php }?></tr>
			<?php }?>
			</table>		 
	</fieldset>
</div> 
<div>
	<fieldset>
		<legend><?php echo $this->translate("Exam Quetion");?></legend>
			
			<table class="table">
			 
			 <tr>
			
			 <td colspan="2">
			 	<canvas style="border:1px solid grey;" id="parent" width="800" height="0"></canvas>
			 </td>
			 </tr>
			 <tr>
			 <td><div id="ordertxt"><?php echo $this->question['apad_ques_no']?></div></td>
			 <td>
			 	<canvas style="border:1px solid grey;" id="Question" width="800" height="300"></canvas>
			 </td>
			 </tr>
			 <tr>
				<td colspan="2">
				<table width="100%" border="0">
					<tr>
					<td   align="center" width="20%">
						 <a class="pre btn" id="pre" href="#">Soal Sebelum</a>
						 </td>
						 <td align="center">
						 <input type="radio" name="answer" value="A" onclick="saveAnswer('A')"> A
						 <input type="radio" name="answer" value="B" onclick="saveAnswer('B')"> B
						 <input type="radio" name="answer" value="C" onclick="saveAnswer('C')"> C
						 <input type="radio" name="answer" value="D" onclick="saveAnswer('D')"> D
						 <input type="radio" name="answer" value="E" onclick="saveAnswer('E')"> E
					</td>
					<td align="center"  width="20%">	
					<a class="next btn" id="next" href="#">Soal Sesudah</a>
			 		</td>
			 	</tr>
				</table>
				</td>
			 </tr>
			 
			</table>		 
	</fieldset>
</div> 
</body>
 